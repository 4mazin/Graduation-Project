<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Recommendation System Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .card {
            background-color: #1f2937;
            border-radius: 0.75rem;
            border: 1px solid #374151;
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: #4f46e5;
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                        0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .loader {
            border: 4px solid #374151;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Course Recommendation System Dashboard</h1>
            <p class="mt-2 text-lg text-gray-400">Explore and search for courses with our intelligent recommender.</p>
        </header>

        <!-- Main Layout -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Left Column: Info -->
            <div class="lg:col-span-1 space-y-6">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-3">Project Overview</h2>
                    <p class="text-gray-400">
                        This project uses TF-IDF and SBERT embeddings to recommend courses based on user input and enrolled courses.
                    </p>
                </div>
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">Models Used</h2>
                    <ul class="list-disc list-inside text-gray-400">
                        <li><span class="text-indigo-400">TF-IDF:</span> Text-based similarity</li>
                        <li><span class="text-indigo-400">SBERT:</span> Semantic similarity</li>
                        <li><span class="text-indigo-400">Hybrid:</span> Combines both</li>
                    </ul>
                </div>
            </div>

            <!-- Middle Column: Search and Recommend -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Search Engine -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">Course Search</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="searchQuery" class="block text-sm font-medium text-gray-300">Search Query</label>
                            <input type="text" id="searchQuery" placeholder="e.g., Python, Data Science, Web Dev..."
                                class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <button id="searchBtn" class="w-full btn-primary font-bold py-2 px-4 rounded-md">
                            Search
                        </button>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-white">Results:</h3>
                        <div id="search-results" class="mt-4 space-y-3 h-80 overflow-y-auto pr-2">
                            <p class="text-gray-400 text-center pt-16">Enter a keyword and click Search.</p>
                        </div>
                    </div>
                </div>

                <!-- Recommendation Demo -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">Recommendations</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="enrolledCourse" class="block text-sm font-medium text-gray-300">Enter Enrolled Course</label>
                            <input type="text" id="enrolledCourse" placeholder="e.g., Machine Learning A-Z"
                                class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <button id="getRecsBtn" class="w-full btn-primary font-bold py-2 px-4 rounded-md">
                            Get Recommendations
                        </button>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-white">Recommended for you:</h3>
                        <div id="recommendation-results" class="mt-4 space-y-3 h-80 overflow-y-auto pr-2">
                            <p class="text-gray-400 text-center pt-16">Enter a course name to get recommendations.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Charts -->
            <div class="lg:col-span-1 space-y-6">
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">Top Categories</h2>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="card p-6">
                    <h2 class="text-xl font-semibold text-white mb-4">Order Status Distribution</h2>
                    <div class="chart-container">
                        <canvas id="orderStatusChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // === SEARCH LOGIC ===
            const searchBtn = document.getElementById('searchBtn');
            const searchResultsContainer = document.getElementById('search-results');

            searchBtn.addEventListener('click', async () => {
                const query = document.getElementById('searchQuery').value.trim();
                if (!query) {
                    searchResultsContainer.innerHTML = '<p class="text-red-400 text-center pt-16">Please enter a search query.</p>';
                    return;
                }

                searchResultsContainer.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div></div>`;

                try {
                    const response = await fetch('http://127.0.0.1:8000/search', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ query })
                    });

                    const data = await response.json();

                    if (data.error) {
                        searchResultsContainer.innerHTML = `<p class="text-red-400 text-center pt-16">${data.error}</p>`;
                        return;
                    }

                    if (!data.results || data.results.length === 0) {
                        searchResultsContainer.innerHTML = '<p class="text-gray-400 text-center pt-16">No courses found.</p>';
                        return;
                    }

                    searchResultsContainer.innerHTML = '';
                    data.results.forEach(course => {
                        const itemHtml = `
                            <div class="p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">
                                <p class="font-semibold text-white">${course.course_name}</p>
                                <p class="text-sm text-gray-400 mt-1">${course.description}</p>
                                <a href="${course.url}" target="_blank" class="text-indigo-400 hover:underline text-sm mt-2 block">View Course</a>
                            </div>
                        `;
                        searchResultsContainer.insertAdjacentHTML('beforeend', itemHtml);
                    });
                } catch (error) {
                    searchResultsContainer.innerHTML = `<p class="text-red-400 text-center pt-16">Error: ${error.message}</p>`;
                }
            });

            // === RECOMMENDATION LOGIC ===
            const getRecsBtn = document.getElementById('getRecsBtn');
            const resultsContainer = document.getElementById('recommendation-results');

            getRecsBtn.addEventListener('click', async () => {
                const course = document.getElementById('enrolledCourse').value.trim();

                if (!course) {
                    resultsContainer.innerHTML = '<p class="text-red-400 text-center pt-16">Please enter a course name.</p>';
                    return;
                }

                resultsContainer.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div></div>`;

                try {
                    const response = await fetch('http://127.0.0.1:8000/recommend', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ enrolled_courses: [course] })
                    });

                    const data = await response.json();

                    if (data.error) {
                        resultsContainer.innerHTML = `<p class="text-red-400 text-center pt-16">${data.error}</p>`;
                        return;
                    }

                    if (!data.recommendations || data.recommendations.length === 0) {
                        resultsContainer.innerHTML = '<p class="text-gray-400 text-center pt-16">No recommendations found.</p>';
                        return;
                    }

                    resultsContainer.innerHTML = '';
                    data.recommendations.forEach(course => {
                        const itemHtml = `
                            <div class="p-3 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">
                                <p class="font-semibold text-white">${course.course_name}</p>
                                <p class="text-sm text-gray-400 mt-1">${course.description}</p>
                                <a href="${course.url}" target="_blank" class="text-indigo-400 hover:underline text-sm mt-2 block">View Course</a>
                            </div>
                        `;
                        resultsContainer.insertAdjacentHTML('beforeend', itemHtml);
                    });
                } catch (error) {
                    resultsContainer.innerHTML = `<p class="text-red-400 text-center pt-16">Error: ${error.message}</p>`;
                }
            });

            // === CHARTS ===
            const categoryData = {
                labels: ['Python', 'Data Science', 'Machine Learning', 'Web Dev', 'AI', 'SQL', 'JavaScript', 'React', 'Java', 'C++'],
                datasets: [{
                    label: 'Courses',
                    data: [200, 180, 160, 150, 140, 120, 110, 100, 90, 80],
                    backgroundColor: 'rgba(79, 70, 229, 0.8)',
                    borderColor: 'rgba(79, 70, 229, 1)',
                    borderWidth: 1
                }]
            };

            const orderStatusData = {
                labels: ['Completed', 'In Progress', 'Wishlist', 'Recommended'],
                datasets: [{
                    label: 'Status',
                    data: [120, 50, 30, 40],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(217, 70, 239, 0.8)'
                    ],
                    borderColor: '#1f2937',
                    borderWidth: 2
                }]
            };

            const chartOptions = (isBar) => ({
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    legend: {
                        display: !isBar,
                        position: 'bottom',
                        labels: { color: '#d1d5db' }
                    }
                },
                scales: isBar ? {
                    y: { beginAtZero: true, grid: { color: '#374151' }, ticks: { color: '#d1d5db' } },
                    x: { grid: { color: '#1f2937' }, ticks: { color: '#d1d5db', maxRotation: 90, minRotation: 45 } }
                } : {}
            });

            new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: categoryData,
                options: chartOptions(true)
            });

            new Chart(document.getElementById('orderStatusChart'), {
                type: 'pie',
                data: orderStatusData,
                options: chartOptions(false)
            });
        });
    </script>
</body>
</html>
